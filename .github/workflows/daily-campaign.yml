name: ðŸ“¢ CampaÃ±a TemÃ¡tica Diaria

on:
  # Ejecutar cada dÃ­a a las 12:00 hora EspaÃ±a (11:00 UTC en invierno, 10:00 UTC en verano)
  schedule:
    - cron: '0 11 * * *'
  
  # Permitir ejecuciÃ³n manual con tema personalizado
  workflow_dispatch:
    inputs:
      theme_override:
        description: 'Tema especÃ­fico (opcional, ej: barbacoas_weber)'
        required: false
        default: ''

jobs:
  daily-campaign:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: projects/01-ofertasflash-bot/package-lock.json

      - name: ðŸ“š Instalar dependencias
        working-directory: projects/01-ofertasflash-bot
        run: npm ci

      - name: ðŸ“¢ Ejecutar CampaÃ±a TemÃ¡tica
        working-directory: projects/01-ofertasflash-bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          AMAZON_ES_TAG: ${{ secrets.AMAZON_ES_TAG }}
          CAMPAIGN_MODE: 'true'
          THEME_OVERRIDE: ${{ github.event.inputs.theme_override }}
        run: npx tsx src/daily-campaign.ts

      - name: ðŸ“Š Resumen
        if: always()
        run: echo "âœ… CampaÃ±a diaria ejecutada a las $(date)"
